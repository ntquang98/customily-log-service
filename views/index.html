<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Shopify Logs</title>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-gray-50 p-6">
    <h1 class="text-2xl font-bold mb-4">Shopify Logs</h1>

    <form
      id="filter-form"
      class="flex flex-wrap gap-4 mb-6 bg-white p-4 rounded shadow"
      hx-get="/"
      hx-target="#log-list"
      hx-swap="innerHTML"
      hx-push-url="true"
    >
      <label class="flex flex-col text-sm">
        Store Domain:
        <input
          type="text"
          name="store"
          value="{{.Store}}"
          class="border rounded p-1"
        />
      </label>
      <label class="flex flex-col text-sm">
        Cart Token:
        <input
          type="text"
          name="cart_token"
          value="{{.CartToken}}"
          class="border rounded p-1"
        />
      </label>
      <label class="flex flex-col text-sm">
        From:
        <input
          type="date"
          name="from"
          value="{{.From}}"
          class="border rounded p-1"
        />
      </label>
      <label class="flex flex-col text-sm">
        To:
        <input
          type="date"
          name="to"
          value="{{.To}}"
          class="border rounded p-1"
        />
      </label>
      <button
        type="submit"
        class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600"
      >
        Filter
      </button>
    </form>

    <div id="log-list" class="bg-white rounded shadow">
      {{template "table" .}}
    </div>

    <div id="log-detail" class="mt-6 bg-white rounded shadow p-4"></div>
    <script>
      document.body.addEventListener("htmx:afterSwap", function (evt) {
        if (evt.target.id === "log-detail") {
          const pre = document.getElementById("json-body");
          if (pre && pre.dataset.raw) {
            try {
              const obj = JSON.parse(pre.dataset.raw);
              pre.textContent = JSON.stringify(obj, null, 2);
            } catch {
              pre.textContent = pre.dataset.raw;
            }
          }

          const pre2 = document.getElementById("json-body-2");
          if (pre2 && pre2.dataset.raw) {
            try {
              const obj = JSON.parse(pre2.dataset.raw);
              pre2.textContent = JSON.stringify(obj, null, 2);
            } catch {
              pre2.textContent = pre.dataset.raw;
            }
          }
        }
      });
    </script>
  </body>
</html>
